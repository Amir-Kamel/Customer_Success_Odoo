<odoo>
  <!-- List view -->
  <record id="view_customer_success_list" model="ir.ui.view">
    <field name="name">customer.success.list</field>
    <field name="model">customer.success</field>
    <field name="arch" type="xml">
      <list string="Customer Success">
        <field name="name"/>
        <field name="partner_id"/>
        <field name="team_id"/>
        <field name="stage_id"/>
        <field name="probability"/>
        <field name="assigned_user_id"/>
      </list>
    </field>
  </record>


<record id="view_customer_success_kanban" model="ir.ui.view">
  <field name="name">customer.success.kanban</field>
  <field name="model">customer.success</field>
  <field name="arch" type="xml">
    <kanban default_group_by="stage_id" class="o_kanban_card">
      <field name="name"/>
      <field name="partner_id"/>
      <field name="team_id"/>
      <field name="stage_id"/>
      <field name="assigned_user_id"/>
      <field name="health_percentage"/>
      <field name="priority"/>

      <templates>
        <t t-name="kanban-box">
          <div t-attf-class="oe_kanban_global_click o_kanban_record d-flex" style="min-height:140px;">
            <div class="card w-100">
              <div class="card-body d-flex flex-column" style="padding:0.75rem;">
                <h5 class="card-title mb-1" style="font-size:1rem; line-height:1.1;">
                  <field name="name"/>
                </h5>

                <div class="card-text mb-1 text-truncate" style="font-size:0.9rem;">
                  <strong>Customer:</strong> <field name="partner_id"/>
                </div>

                <div class="d-flex justify-content-between align-items-center mb-2" style="font-size:0.85rem;">
                  <div class="text-muted">Team: <field name="team_id"/></div>
                  <div class="text-muted">Assigned: <field name="assigned_user_id"/></div>
                </div>

                <div style="flex:1 1 auto;"></div>

                <div class="d-flex align-items-center justify-content-between">
                  <div><field name="priority" widget="priority"/></div>
                  <div class="small text-muted"><t t-esc="(record.health_percentage.value || 0)"/>%</div>
                </div>

                <!-- Compute percentage and assign Bootstrap colors -->
                <t t-set="pct_int" t-value="record.health_percentage.value || 0"/>
                <t t-set="bar_class"
                   t-value="pct_int &lt;= 25 ? 'bg-danger' : (pct_int &lt;= 50 ? 'bg-warning' : (pct_int &lt;= 75 ? 'bg-primary' : 'bg-success'))"/>

                <div class="progress mt-2" style="height:10px; border-radius:6px; overflow:hidden;">
                  <div role="progressbar"
                       t-att-class="'progress-bar ' + bar_class"
                       t-att-style="'width: ' + pct_int + '%;'"
                       t-att-aria-valuenow="pct_int"
                       aria-valuemin="0" aria-valuemax="100">
                  </div>
                </div>

                <div t-if="record.stage_id and record.stage_id.fold" class="mt-2 text-end" style="font-size:1.1rem;">ðŸŽ‰</div>
              </div>
            </div>
          </div>
        </t>
      </templates>
    </kanban>
  </field>
</record>



  <!-- Form view -->
  <record id="view_customer_success_form" model="ir.ui.view">
    <field name="name">customer.success.form</field>
    <field name="model">customer.success</field>
    <field name="arch" type="xml">
      <form string="Customer Success">
        <header>

           <button name="action_set_won"
                    string="Won"
                    type="object"
                    class="oe_highlight"
                    data-hotkey="w"
                    title="Mark as won"
                    invisible="not active or probability == 100 or type == 'lead'"/>
            <button name="action_set_lost"
                    string="Lost"
                    type="object"
                    class="btn-danger"
                    data-hotkey="l"
                    title="Mark as lost"
                    invisible="not active"/>
            <field name="stage_id" widget="statusbar" options="{'clickable': '1', 'fold_field': 'fold'}"/>

        </header>

        <sheet>
           <!-- smart button -->
          <div class="oe_button_box" name="button_box">
          <button name="action_open_related_crm_lead"
                  type="object"
                  class="oe_stat_button"
                  icon="fa-briefcase"
                  string="Related CRM Lead"
                  invisible="related_crm_lead_id == False"/>
          </div>

          <widget name="web_ribbon" title="Won" bg_color="text-bg-success" invisible="probability != 100 or not active"/>

          <group>
            <group>
              <field name="name"/>
              <field name="partner_id"/>
              <field name="health_score"/>
              <field name="probability"/>
            </group>
            <group>
              <field name="team_id"/>
              <field name="assigned_user_id"/>
              <field name="phone"/>
              <field name="email"/>
            </group>
            <group>
              <field name="renewal_date"/>

              <field name="priority" widget="priority"/>
              <field name="tag_ids" widget="many2many_tags" options="{'color_field':'color'}"/>
            </group>
          </group>
          <notebook>
            <page string="Feedback">
              <field name="last_feedback"/>
            </page>
          </notebook>
        </sheet>
      </form>
    </field>
  </record>

  <!-- Search -->
  <record id="view_customer_success_search" model="ir.ui.view">
    <field name="name">customer.success.search</field>
    <field name="model">customer.success</field>
    <field name="arch" type="xml">
      <search string="Customer Success">
        <field name="name"/>
        <field name="partner_id"/>
        <field name="team_id"/>
        <field name="stage_id"/>
        <field name="assigned_user_id"/>
        <filter string="Won" name="filter_won" domain="[('stage_id.name','=','Won')]"/>
        <filter string="Lost" name="filter_lost" domain="[('stage_id.name','=','Lost')]"/>
        <filter string="Proposition" name="filter_prop" domain="[('stage_id.name','=','Proposition')]"/>
      </search>
    </field>
  </record>

  <!-- Action -->
  <record id="action_customer_success" model="ir.actions.act_window">
    <field name="name">Customer Success</field>
    <field name="res_model">customer.success</field>
    <field name="view_mode">kanban,list,form</field>
    <field name="view_id" ref="view_customer_success_kanban"/>
    <field name="view_ids" eval="[(6,0,[ref('view_customer_success_kanban'), ref('view_customer_success_list'), ref('view_customer_success_form')])]"/>
    <field name="help" type="html">
      <p class="o_view_nocontent_smiling_face">
        Create and manage Customer Success records.
      </p>
    </field>
  </record>

</odoo>

