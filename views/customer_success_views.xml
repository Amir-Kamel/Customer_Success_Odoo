<odoo>
    <!-- Kanban view -->
    <record id="view_customer_success_kanban" model="ir.ui.view">
        <field name="name">customer.success.kanban</field>
        <field name="model">customer.success</field>
        <field name="arch" type="xml">
            <kanban class="o_kanban_card" default_group_by="stage_id">
                <!-- fields listed here are requested by the web client -->
                <field name="name"/>
                <field name="partner_id"/>
                <field name="team_id"/>
                <field name="stage_id"/>
                <field name="assigned_user_id"/>
                <field name="health_percentage"/>

                <templates>
                    <t t-name="kanban-box">
                        <!-- make card flexible so progress bar is visible -->
                        <div t-attf-class="oe_kanban_global_click o_kanban_record d-flex flex-column">
                            <div class="oe_kanban_content" style="min-height:110px; padding-bottom:8px;">
                                <!-- Title -->
                                <strong><field name="name"/></strong>

                                <!-- Partner -->
                                <div class="o_kanban_partner" style="margin-top:6px;">
                                    <field name="partner_id"/>
                                </div>

                                <!-- Team & Assigned (small row) -->
                                <div class="o_kanban_small_row" style="margin-top:6px;">
                                    <div>Team: <field name="team_id"/></div>
                                    <div style="margin-top:4px;">Assigned: <field name="assigned_user_id"/></div>
                                </div>

                                <!-- Spacer to avoid cutting the progress bar -->
                                <div style="flex:1 1 auto;"></div>

                                <!-- Health Bar (OWL field access) -->
                                <div class="progress mt-2" style="height:18px; margin-top:8px;">
                                    <div class="progress-bar"
                                         role="progressbar"
                                         t-att-style="'width: %s%%;' % (record.health_percentage.value or 0)"
                                         t-att-aria-valuenow="record.health_percentage.value or 0"
                                         aria-valuemin="0" aria-valuemax="100">
                                        <t t-esc="record.health_percentage.value or 0"/>%
                                    </div>
                                </div>

                                <!-- Emoji if last stage (fold True) -->
                                <div t-if="record.stage_id and record.stage_id.fold" style="margin-top:6px;">
                                    ðŸŽ‰
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>


    <!-- Form view -->
    <record id="view_customer_success_form" model="ir.ui.view">
        <field name="name">customer.success.form</field>
        <field name="model">customer.success</field>
        <field name="arch" type="xml">
            <form string="Customer Success">

                <header>
                <button name="action_open_related_crm_lead"
                        string="Open Related CRM Lead"
                        type="object"
                        class="o_form_button_custom btn btn-outline-primary"
                        invisible="related_crm_lead_id == False"/>
            </header>

                <sheet>
                    <group>
                        <field name="name"/>
                        <field name="partner_id"/>
                        <field name="phone"/>
                        <field name="email"/>
                        <field name="team_id"/>
                        <field name="assigned_user_id"/>
                        <field name="stage_id"/>

                        <field name="renewal_date"/>
                        <field name="related_crm_lead_id"/>
                        <field name="tag_ids" widget="many2many_tags" options="{'color_field':'color'}"/>
                        <field name="health_percentage" readonly="1"/>
                        <field name="last_feedback"/>
                    </group>
                    <notebook>
                        <page string="Internal Notes">

                              <field name="last_feedback"/>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <!-- Action -->
    <record id="action_customer_success" model="ir.actions.act_window">
        <field name="name">Customer Success</field>
        <field name="res_model">customer.success</field>
        <field name="view_mode">kanban,form</field>
        <field name="view_id" ref="view_customer_success_kanban"/>
    </record>

</odoo>
